user@user-VirtualBox:~$ sudo touch /etc/iptables_1.rules
[sudo] password for user:
user@user-VirtualBox:~$ sudo iptables -F
user@user-VirtualBox:~$ sudo iptables --line-numbers -L -n -v
Chain INPUT (policy ACCEPT 14 packets, 1068 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 17 packets, 1123 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain DOCKER (0 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain DOCKER-ISOLATION-STAGE-1 (0 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain DOCKER-ISOLATION-STAGE-2 (0 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain DOCKER-USER (0 references)
num   pkts bytes target     prot opt in     out     source               destination
user@user-VirtualBox:~$ sudo iptables -P INPUT DROP
user@user-VirtualBox:~$ client_loop: send disconnect: Connection reset
user@user-VirtualBox:~$ sudo iptables -P OUTPUT DROP
user@user-VirtualBox:~$ sudo iptables -P FORWARD DROP
user@user-VirtualBox:~$ sudo iptables -L
Chain INPUT (policy DROP)
target     prot opt source               destination         

Chain FORWARD (policy DROP)
target     prot opt source               destination         

Chain OUTPUT (policy DROP)
target     prot opt source               destination         

Chain DOCKER (0 references)
target     prot opt source               destination         

Chain DOCKER-ISOLATION-STAGE-1 (0 references)
target     prot opt source               destination         

Chain DOCKER-ISOLATION-STAGE-2 (0 references)
target     prot opt source               destination         

Chain DOCKER-USER (0 references)
target     prot opt source               destination
user@user-VirtualBox:~$ sudo iptables -A INPUT -i lo -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A OUTPUT -o lo -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A OUTPUT -p icmp -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A INPUT -p icmp -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A OUTPUT -p tcp -m tcp --sport 22 -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
user@user-VirtualBox:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:20:dd:e9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.43.100/24 brd 192.168.43.255 scope global dynamic noprefixroute enp0s3
       valid_lft 2956sec preferred_lft 2956sec
    inet6 fe80::9d3c:50b9:2ef:125f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:86:7e:9d:c8 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
user@user-VirtualBox:~$ sudo iptables -A INPUT -i enp0s3 -p tcp -m tcp --dport 80 -j ACCEPT
user@user-VirtualBox:~$ sudo iptables -A OUTPUT -o enp0s3 -p tcp -m tcp --sport 80 -j ACCEPT
user@user-VirtualBox:~$ sudo iptables-save > iptables_1.rules
user@user-VirtualBox:~$ cat iptables_1.rules 
# Generated by iptables-save v1.8.4 on Thu Feb  3 11:41:46 2022
*filter
:INPUT DROP [1:229]
:FORWARD DROP [0:0]
:OUTPUT DROP [1560:97656]
:DOCKER - [0:0]
:DOCKER-ISOLATION-STAGE-1 - [0:0]
:DOCKER-ISOLATION-STAGE-2 - [0:0]
:DOCKER-USER - [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -i enp0s3 -p tcp -m tcp --dport 80 -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p icmp -j ACCEPT
-A OUTPUT -p tcp -m tcp --sport 22 -j ACCEPT
-A OUTPUT -o enp0s3 -p tcp -m tcp --sport 80 -j ACCEPT
COMMIT
# Completed on Thu Feb  3 11:41:46 2022
# Generated by iptables-save v1.8.4 on Thu Feb  3 11:41:46 2022
*nat
:PREROUTING ACCEPT [31:4082]
:INPUT ACCEPT [16:2244]
:OUTPUT ACCEPT [4999:326919]
:POSTROUTING ACCEPT [467:40239]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A DOCKER -i docker0 -j RETURN
COMMIT
# Completed on Thu Feb  3 11:41:46 2022
user@user-VirtualBox:~$ telnet 192.168.43.100 80
Trying 192.168.43.100...
Connected to 192.168.43.100.
Escape character is '^]'.
^CConnection closed by foreign host.
user@user-VirtualBox:~$ telnet 192.168.43.100 22
Trying 192.168.43.100...
Connected to 192.168.43.100.
Escape character is '^]'.
SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.4
^C
Connection closed by foreign host.
user@user-VirtualBox:~$ sudo iptables --line-numbers -L -n -v
Chain INPUT (policy DROP 4 packets, 463 bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1      312 22804 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
2        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           
3        0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22
4        0     0 ACCEPT     tcp  --  enp0s3 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy DROP 4200 packets, 263K bytes)
num   pkts bytes target     prot opt in     out     source               destination         
1      312 22804 ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0           
2        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           
3        0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22
4        0     0 ACCEPT     tcp  --  *      enp0s3  0.0.0.0/0            0.0.0.0/0            tcp spt:80

Chain DOCKER (0 references)
num   pkts bytes target     prot opt in     out     source               destination         

Chain DOCKER-ISOLATION-STAGE-1 (0 references)
num   pkts bytes target     prot opt in     out     source               destination         

Chain DOCKER-ISOLATION-STAGE-2 (0 references)
num   pkts bytes target     prot opt in     out     source               destination         

Chain DOCKER-USER (0 references)
num   pkts bytes target     prot opt in     out     source               destination         
user@user-VirtualBox:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:20:dd:e9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.43.100/24 brd 192.168.43.255 scope global dynamic noprefixroute enp0s3
       valid_lft 2290sec preferred_lft 2290sec
    inet6 fe80::9d3c:50b9:2ef:125f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:86:7e:9d:c8 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
